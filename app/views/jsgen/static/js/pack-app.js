//router.js
angular.module("jsGen.router",["ngRoute"]).constant("app",{version:jsGenVersion}).provider("getFile",["app",function(d){this.html=function(c){return"/static/tpl/"+c+"?v="+(d.version||"")};this.md=function(c){return"/static/md/"+c+"?v="+(d.version||"")};this.$get=function(){return{html:this.html,md:this.md}}}]).config(["$routeProvider","$locationProvider","getFileProvider",function(d,c,a){var b={templateUrl:a.html("index.html"),controller:"indexCtrl"},k={templateUrl:a.html("login.html"),controller:"userLoginCtrl"},
l={templateUrl:a.html("register.html"),controller:"userRegisterCtrl"},f={templateUrl:a.html("user.html"),controller:"homeCtrl"},g={templateUrl:a.html("admin.html"),controller:"adminCtrl"},h={templateUrl:a.html("article-editor.html"),controller:"articleEditorCtrl"},m={templateUrl:a.html("index.html"),controller:"tagCtrl"},n={templateUrl:a.html("reset.html"),controller:"userResetCtrl"},e={templateUrl:a.html("user.html"),controller:"userCtrl"},p={templateUrl:a.html("article.html"),controller:"articleCtrl"};
a={templateUrl:a.html("collection.html"),controller:"collectionCtrl"};d.when("/hots",b).when("/update",b).when("/latest",b).when("/T:ID",b).when("/tag/:TAG",b).when("/login",k).when("/register",l).when("/reset",n).when("/home",f).when("/home/:OP",f).when("/admin",g).when("/admin/:OP",g).when("/tag",m).when("/add",h).when("/A:ID/edit",h).when("/user/U:ID",e).when("/user/U:ID/:OP",e).when("/U:ID",e).when("/U:ID/:OP",e).when("/A:ID",p).when("/C:ID",a).when("/",b).otherwise({redirectTo:"/"});c.html5Mode(!0).hashPrefix("!")}]);

//tools.js
angular.module("jsGen.tools",[]).factory("tools",function(){function l(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function q(a){return null===a||void 0===a||a!==a}function r(a){return q(a)?"":a+""}function m(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function s(a){if(a)for(var b in a)return!m(a,b);return!0}function g(a){var b=typeof a;return null===a?"null":l(a)?"array":b}function f(a,b,c,e,d){b=b||angular.noop;if(a)if(e||l(a))if(d)for(e=
a.length-1;0<=e&&b.call(c,a[e],e,a)!==n;e--);else for(e=0,d=a.length;e<d&&b.call(c,a[e],e,a)!==n;e++);else for(var h in a)if(m(a,h)&&b.call(c,a[h],h,a)===n)break}function k(a,b){var c=g(a);void 0===b&&(b=a,a="object"===c?{}:[]);c===g(b)&&("object"===c||"array"===c?f(b,function(b,c){var h=g(b);"object"===h||"array"===h?(a[c]=h===g(a[c])?a[c]:"object"===h?{}:[],k(a[c],b)):a[c]="function"===h?null:b}):a="function"===c?null:b);return a}function p(a,b){var c=g(a);if(c===g(b)&&("array"===c||"object"===
c))if(s(a))k(a,b);else if("array"===c&&1===a.length){var e=a[0],d=g(e);a.length=0;"function"!==d&&f(b,function(b){var c=g(b);if("null"===d||d===c)"object"===d||"array"===d?a.push(p(k(e),b)):a.push(k(b))})}else f(a,function(e,d){var f=g(e);"array"===c||m(b,d)?"function"===f&&"array"===c?a[d]=null:"null"===f?a[d]=k(b[d]):f===g(b[d])?"object"===f||"array"===f?p(a[d],b[d]):a[d]=b[d]:delete a[d]:delete a[d]});return a}var n={};return{trim:function(a,b){return r(a).replace(b?/\s+/g:/ +/g," ").replace(/^\s+/,
"").replace(/\s+$/,"")},each:f,some:function(a,b,c){var e=!1,d=Array.prototype.some;b=b||angular.noop;if(a){if(d&&a.some===d)return a.some(b,c);f(a,function(a,d,f){if(e=b.call(c,a,d,f))return n});return!!e}return e},union:k,toStr:r,isNull:q,hasOwn:m,isEmpty:s,isArray:l,intersect:p,checkType:g,remove:function(a,b){var c=0;l(a)?f(a,function(e,d){e===b&&(a.splice(d,1),c+=1)},null,!0,!0):f(a,function(e,d){e===b&&(delete a[d],c+=1)},null,!1);return c}}});

//locale_zh-cn.js
angular.module("jsGen.locale",["ngLocale"]).run(["$locale",function(a){angular.extend(a,{RESET:{locked:"\u7533\u8bf7\u89e3\u9501",passwd:"\u627e\u56de\u5bc6\u7801",email:"\u8bf7\u6c42\u4fe1\u606f\u5df2\u53d1\u9001\u5230\u60a8\u7684\u90ae\u7bb1\uff0c\u8bf7\u67e5\u6536\u3002"},RESPONSE:{success:"\u8bf7\u6c42\u6210\u529f",error:"\u8bf7\u6c42\u5931\u8d25"},VALIDATE:{required:"\u5fc5\u586b\uff01",minlength:"\u592a\u77ed\uff01",maxlength:"\u592a\u957f\uff01",min:"\u592a\u5c0f\uff01",max:"\u592a\u5927\uff01",
more:"\u592a\u591a\uff01",email:"Email\u65e0\u6548\uff01",pattern:"\u683c\u5f0f\u65e0\u6548\uff01",username:"\u6709\u6548\u5b57\u7b26\u4e3a\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\uff0c\u4ee5\u6c49\u5b57\u6216\u5c0f\u5199\u5b57\u6bcd\u5f00\u5934\uff01",minname:"\u957f\u5ea6\u5e94\u5927\u4e8e5\u5b57\u8282\uff0c\u4e00\u4e2a\u6c49\u5b573\u5b57\u8282\uff01",maxname:"\u957f\u5ea6\u5e94\u5c0f\u4e8e15\u5b57\u8282\uff0c\u4e00\u4e2a\u6c49\u5b573\u5b57\u8282\uff01",repasswd:"\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01",
url:"URL\u65e0\u6548\uff01",tag:"\u6807\u7b7e\u9519\u8bef\uff0c\u4e0d\u80fd\u5305\u542b\u201c,\u201d\u3001\u201c\uff0c\u201d\u548c\u201c\u3001\u201d"},BTN_TEXT:{confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",remove:"\u5220\u9664",goBack:"\u8fd4\u56de"},TIMING:{goHome:"\u79d2\u949f\u540e\u81ea\u52a8\u8fd4\u56de\u4e3b\u9875"},HOME:{title:"\u6211\u7684\u4e3b\u9875",index:" \u66f4\u65b0\uff0c\u9605\u8bfb\u65f6\u95f4\u7ebf\uff1a",mark:"\u6211\u7684\u6536\u85cf",article:"\u6211\u7684\u6587\u7ae0",comment:"\u6211\u7684\u8bc4\u8bba",
follow:"\u6211\u7684\u5173\u6ce8",fans:"\u6211\u7684\u7c89\u4e1d"},ADMIN:{index:"\u7f51\u7ad9\u4fe1\u606f",user:"\u7528\u6237\u7ba1\u7406",tag:"\u6807\u7b7e\u7ba1\u7406",article:"\u6587\u7ae0\u7ba1\u7406",comment:"\u8bc4\u8bba\u7ba1\u7406",message:"\u6d88\u606f\u7ba1\u7406",global:"\u7f51\u7ad9\u8bbe\u7f6e",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u8bbe\u7f6e\u6682\u65e0\u53d8\u66f4"},ARTICLE:{title:"\u6dfb\u52a0/\u7f16\u8f91\u6587\u7ae0",preview:"\u9884\u89c8\uff1a",reply:"\u8bc4\u8bba\uff1a",
removed:"\u6210\u529f\u5220\u9664 ",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u6587\u7ae0\u6682\u65e0\u53d8\u66f4",added:"\u6210\u529f\u4fdd\u5b58 ",markdown:"Markdown\u7b80\u660e\u8bed\u6cd5",marked:"\u5df2\u6536\u85cf ",unmarked:"\u5df2\u53d6\u6d88\u6536\u85cf ",favored:"\u5df2\u652f\u6301 ",unfavored:"\u5df2\u53d6\u6d88\u652f\u6301 ",opposed:"\u5df2\u53cd\u5bf9 ",unopposed:"\u5df2\u53d6\u6d88\u53cd\u5bf9 ",highlight:"\u7f6e\u9876 ",unhighlight:"\u53d6\u6d88\u7f6e\u9876 "},USER:{title:"\u7684\u4e3b\u9875",
login:"\u7528\u6237\u767b\u5f55",reset:"\u7528\u6237\u4fe1\u606f\u627e\u56de",register:"\u7528\u6237\u6ce8\u518c",article:"\u7684\u6587\u7ae0",fans:"\u7684\u7c89\u4e1d",followed:"\u5df2\u5173\u6ce8 ",unfollowed:"\u5df2\u53d6\u6d88\u5173\u6ce8 ",email:"\u9a8c\u8bc1\u90ae\u4ef6\u5df2\u53d1\u9001\u5230\u65b0\u90ae\u7bb1\uff0c\u901a\u8fc7\u9a8c\u8bc1\u540e\u624d\u4fdd\u5b58\u4fee\u6539",updated:"\u7528\u6237\u4fe1\u606f\u66f4\u65b0\u6210\u529f",noUpdate:"\u7528\u6237\u4fe1\u606f\u6682\u65e0\u53d8\u66f4",
noLogin:"\u60a8\u8fd8\u672a\u767b\u5f55"},TAG:{title:"\u70ed\u95e8\u6807\u7b7e",removed:"\u6210\u529f\u5220\u9664 ",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u6807\u7b7e\u6682\u65e0\u53d8\u66f4"},FILTER:{role:"\u7981\u8a00 \u5f85\u9a8c\u8bc1 \u4f1a\u5458 \u7ec4\u5458 \u7f16\u8f91 \u7ba1\u7406\u5458".split(" "),follow:["\u5173\u6ce8","\u5df2\u5173\u6ce8"],favor:["\u652f\u6301","\u5df2\u652f\u6301"],mark:["\u6536\u85cf","\u5df2\u6536\u85cf"],oppose:["\u53cd\u5bf9","\u5df2\u53cd\u5bf9"],highlight:["\u7f6e\u9876",
"\u53d6\u6d88\u7f6e\u9876"],turn:["\u5f00\u542f","\u5173\u95ed"],edit:["\u6dfb\u52a0","\u7f16\u8f91"],gender:{male:"\u7537",female:"\u5973"}},DATETIME:{second:"\u79d2",minute:"\u5206",hour:"\u65f6",day:"\u5929",month:"\u6708",year:"\u5e74",fullD:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",shortD:"MM-dd HH:mm",dayAgo:"\u5929\u524d",hourAgo:"\u5c0f\u65f6\u524d",minuteAgo:"\u5206\u949f\u524d",secondAgo:"\u521a\u521a"}})}]);

//services.js
angular.module("jsGen.services",["ngResource","ngCookies"]).factory("restAPI",["$resource",function(b){return{index:b("/api/index/:OP"),user:b("/api/user/:ID/:OP"),article:b("/api/article/:ID/:OP"),tag:b("/api/tag/:ID/:OP")}}]).factory("cache",["$cacheFactory",function(b){return{user:b("user",{capacity:20}),article:b("article",{capacity:100}),comment:b("comment",{capacity:500}),list:b("list",{capacity:100})}}]).factory("myConf",["$cookieStore","tools",function(b,a){function c(d,c){return function(f,
e,h){e=a.toStr(e)+d;h=a.isNull(h)?c:h;var k;k=b.get(e);var l=h;k=a.isNull(k)?l:k;a.isNull(f)||k===(a.isNull(f)?h:f)||(b.put(e,f),k=f);return k}}return{pageSize:c("PageSize",10),sumModel:c("sumModel",!1)}}]).factory("anchorScroll",function(){function b(a){a=$(a);var b=$(window),d=b.height(),g=a.offset().top;a=a.outerHeight();var b=b.scrollTop(),f=b+d;return g+(a>d?d:a)/2>b&&g+(a>d?d:a)/2<f?!0:a>d?g+a-d/2>b&&g+a-d/2<f:!1}return{toView:function(a,c,d){var g=$(window).height();a=$(a);d=0<d?d:g/10;$("html, body").animate({scrollTop:c?
a.offset().top-d:a.offset().top+a.outerHeight()+d-g},{duration:200,easing:"linear",complete:function(){b(a)||a[0].scrollIntoView(!!c)}})},inView:b}}).factory("isVisible",function(){return function(b){b=b[0].getBoundingClientRect();return!!(b.bottom-b.top)}}).factory("applyFn",["$rootScope",function(b){return function(a,c){a=angular.isFunction(a)?a:angular.noop;c=c&&c.$apply?c:b;a();c.$$phase||c.$apply()}}]).factory("timing",["$rootScope","$q","$exceptionHandler",function(b,a,c){function d(d,f,e){var h,
k=0,l=a.defer(),m=l.promise;d=angular.isFunction(d)?d:angular.noop;f=parseInt(f,10);e=parseInt(e,10);e=0<=e?e:0;h=window.setInterval(function(){k+=1;if(e&&k>=e)window.clearInterval(h),l.resolve(d(k,e,f));else try{d(k,e,f)}catch(a){l.reject(a),c(a)}b.$$phase||b.$apply()},f);m.$timingId=h;return m}d.cancel=function(a){return a&&a.$timingId?(clearInterval(a.$timingId),!0):!1};return d}]).factory("promiseGet",["$q",function(b){return function(a,c,d,g){var f,e=b.defer();(f=d&&g&&g.get(d))?e.resolve(f):
c.get(a,function(a){d&&g&&g.put(d,a);e.resolve(a)},function(a){e.reject(a.error)});return e.promise}}]).factory("getList",["restAPI","cache","promiseGet",function(b,a,c){return function(d){return c({ID:d,s:10},b.article,d,a.list)}}]).factory("getArticle",["restAPI","cache","promiseGet",function(b,a,c){return function(d){return c({ID:d},b.article,d,a.article)}}]).factory("getUser",["restAPI","cache","promiseGet",function(b,a,c){return function(d){return c({ID:d},b.user,d,a.user)}}]).factory("getMarkdown",
["$http",function(b){return b.get("/static/md/markdown.md",{cache:!0})}]).factory("toast",["$log","tools",function(b,a){var c={};angular.forEach(["info","error","success","warning"],function(d){c[d]=function(c,f){var e=b[d]||b.log;f=a.toStr(f);e(c,f);c=angular.isObject(c)?angular.toJson(c):a.toStr(c);toastr[d](c,f)}});toastr.options=angular.extend({positionClass:"toast-bottom-full-width"},c.options);c.clear=toastr.clear;return c}]).factory("pretty",function(){return prettyPrint}).factory("param",
function(){return $.param}).factory("CryptoJS",function(){return CryptoJS}).factory("utf8",function(){return utf8}).factory("mdParse",["tools",function(b){return function(a){return marked(b.toStr(a))}}]).factory("sanitize",["tools",function(b){var a=Sanitize,c=a.Config,d=[new a({}),new a(c.RESTRICTED),new a(c.BASIC),new a(c.RELAXED)];return function(a,c){var e=document.createElement("div"),h=document.createElement("div");c=0<=c?c:3;e.innerHTML=b.toStr(a);h.appendChild(d[c].clean_node(e));return h.innerHTML}}]).factory("mdEditor",
["mdParse","sanitize","pretty","tools",function(b,a,c,d){return function(g,f){g=d.toStr(g);var e=new Markdown.Editor({makeHtml:function(c){return a(b(c),f)}},g),h=angular.element(document.getElementById("wmd-preview"+g));e.hooks.chain("onPreviewRefresh",function(){angular.forEach(h.find("code"),function(a){a=angular.element(a);a.parent().is("pre")||a.addClass("prettyline")});h.find("pre").addClass("prettyprint");c()});return e}}]);

//filters.js
angular.module("jsGen.filters",[]).filter("placeholder",["tools",function(c){return function(a){return c.toStr(a)||"-"}}]).filter("match",["$locale",function(c){return function(a,b){return c.FILTER[b]&&c.FILTER[b][a]||""}}]).filter("switch",["$locale",function(c){return function(a,b){return c.FILTER[b]&&c.FILTER[b][+!!a]||""}}]).filter("checkName",["tools",function(c){return function(a){a=c.toStr(a);return/^[(\u4e00-\u9fa5)a-z][(\u4e00-\u9fa5)a-zA-Z0-9_]{1,}$/.test(a)}}]).filter("length",["utf8",
"tools",function(c,a){return function(b){b=a.toStr(b);return c.stringToBytes(b).length}}]).filter("cutText",["utf8","tools",function(c,a){return function(b,e){b=a.trim(b);var d=c.stringToBytes(b);e=0<e?e:0;d.length>e&&(d.length=e,b=c.bytesToString(d),b=b.slice(0,-2)+"\u2026");return b}}]).filter("formatDate",["$filter","$locale",function(c,a){return function(b,e){var d=Date.now()-b,f=c("date");return e?f(b,a.DATETIME.fullD):2592E5<d?f(b,a.DATETIME.shortD):864E5<d?Math.floor(d/864E5)+a.DATETIME.dayAgo:
36E5<d?Math.floor(d/36E5)+a.DATETIME.hourAgo:6E4<d?Math.floor(d/6E4)+a.DATETIME.minuteAgo:a.DATETIME.secondAgo}}]).filter("formatTime",["$locale",function(c){return function(a){function b(a){d=f%a;return f=(f-d)/a}var e="",d=0,f=0<a?Math.round(+a):Math.floor(Date.now()/1E3);a=c.DATETIME;b(60);e=d+a.second;b(60);e=(0<d?d+a.minute:"")+e;b(24);e=(0<d?d+a.hour:"")+e;return 0<f?f+a.day+e:e}}]).filter("formatBytes",["$locale",function(c){return function(a){return(a=0<a?a:0)?1024>a?a+"B":1048576>a?(a/1024).toFixed(3)+
" KiB":1073741824>a?(a/1048576).toFixed(3)+" MiB":(a/1073741824).toFixed(3)+" GiB":"-"}}]);

//directives.js
angular.module("jsGen.directives",[]).directive("genParseMd",["mdParse","sanitize","pretty","isVisible","$timeout",function(h,d,e,b,g){return function(a,c,n){function k(a){angular.isDefined(a)&&(a=h(a),a=d(a),c.html(a),angular.forEach(c.find("code"),function(a){a=angular.element(a);a.parent().is("pre")||a.addClass("prettyline")}),c.find("pre").addClass("prettyprint"),c.find("a").attr("target",function(){if(this.host!==location.host)return"_blank"}),e())}a.$watch(n.genParseMd,function(a){b(c)?k(a):
g(function(){k(a)},500)})}}]).directive("genTabClick",function(){return{link:function(h,d,e){var b=e.genTabClick;d.bind("click",function(){d.parent().children().removeClass(b);d.addClass(b)})}}}).directive("genPagination",["getFile",function(h){return{scope:!0,templateUrl:h.html("gen-pagination.html"),link:function(d,e,b){d.$watchCollection(b.genPagination,function(b){if(angular.isObject(b)){var a=1,c=[],e=Math.ceil(b.total/b.pageSize)||1,a=1<=b.pageIndex?b.pageIndex:1,a=a<=e?a:e;c[0]=a;if(6>=a)for(;1<
c[0];)c.unshift(c[0]-1);else c.unshift(c[0]-1),c.unshift(c[0]-1),c.unshift("\u2026"),c.unshift(2),c.unshift(1);if(5>=e-a)for(;c[c.length-1]<e;)c.push(c[c.length-1]+1);else c.push(c[c.length-1]+1),c.push(c[c.length-1]+1),c.push("\u2026"),c.push(e-1),c.push(e);d.prev=1<a?a-1:0;d.next=a<e?a+1:0;d.total=b.total;d.pageIndex=a;d.showPages=c;d.pageSize=b.pageSize;d.perPages=b.sizePerPage||[10,20,50];d.path=b.path&&b.path+"?p="}});d.paginationTo=function(b,a){!d.path&&0<b&&(a=a||d.pageSize,d.$emit("genPagination",
b,a))}}}}]).directive("genModal",["getFile","$timeout",function(h,d){var e=0;return{scope:!0,transclude:!0,templateUrl:h.html("gen-modal.html"),link:function(b,g,a){function c(a){return function(){var b=p(a)?a():!0;k(!b)}}function h(){var a=$(window),b=l.children(),a=0.382*(a.height()-b.outerHeight()),c={};c.marginTop=0<a?a:0;b.css(c)}function k(a){l.modal(a?"show":"hide");a&&d(h)}var m,l=g.children(),f=b.$eval(a.genModal),p=angular.isFunction;f.cancelFn=f.cancelFn||!0;f.backdrop=f.backdrop||!0;f.show=
f.show||!1;f.modal=k;b.$watch(function(){return f},function(a){angular.extend(b,a)},!0);b.id=b.id||a.genModal+"-"+e++;angular.forEach(["Confirm","Cancel","Delete"],function(a){var d=a.toLowerCase(),e=d+"Fn",g=d+"Btn";b[d+"Cb"]=f[e]&&c(f[e]);b[g]=f[g]||f[e]&&a});l.on("shown.bs.modal",function(a){m=!0});l.on("hidden.bs.modal",function(a){m&&p(f.cancelFn)&&f.cancelFn();m=!1});l.modal(f)}}}]).directive("genTooltip",["$timeout","isVisible",function(h,d){return{require:"?ngModel",link:function(e,b,g,a){function c(c){a.validate=
l&&f.validate&&d(b);if(a.validate){var e=a.$name&&a.$name+" "||"";c&&f.validateMsg&&angular.forEach(a.$error,function(a,b){e+=a&&f.validateMsg[b]&&f.validateMsg[b]+", "||""});e=e.slice(0,-2)||g.originalTitle||g.title;g.$set("dataOriginalTitle",e?e:"");m(!!c)}else m(!1)}function n(b){h(function(){c(a.$invalid)});return b}function k(){b.off(".tooltip").removeData("bs.tooltip");b.tooltip(f)}function m(a){b.hasClass("invalid-error")!==a&&(b[a?"addClass":"removeClass"]("invalid-error"),b.tooltip(a?"show":
"hide"))}var l=!1,f=e.$eval(g.genTooltip)||{};"inner"===f.container?f.container=b:"ngView"===f.container&&(f.container=b.parents(".ng-view")[0]||b.parents("[ng-view]")[0]);f.validate?(f.template='<div class="tooltip validate-tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',f.trigger="manual",f.placement=f.placement||"right",a?(a.$formatters.push(n),a.$parsers.push(n)):e.$watch(function(){return g.originalTitle||g.dataOriginalTitle},m),b.bind("focus",function(){b.trigger("input");
b.trigger("change")}),e.$on("genTooltipValidate",function(b,e,d){l=!d;a&&(angular.isArray(e)&&e.push(a),c(a.$invalid))})):f.click&&b.bind("click",function(){b.tooltip(f.click)});b.bind("hidden.bs.tooltip",k);k()}}}]).directive("genMoving",["anchorScroll",function(h){return{link:function(d,e,b){function g(){var a=e.find("textarea");a.is(a)&&a.css({height:"auto",width:"100%"})}d=d.$eval(b.genMoving);d.appendTo=function(a){e.appendTo($(a));g()};d.prependTo=function(a){e.prependTo($(a));g()};d.childrenOf=
function(a){return $(a).find(e).is(e)};d.scrollIntoView=function(a,b){h.toView(e,a,b)};d.inView=function(){return h.inView(e)}}}}]).directive("genSrc",["isVisible",function(h){return{priority:99,link:function(d,e,b){b.$observe("genSrc",function(d){if(d&&h(e)){var a=new Image;a.onload=function(){b.$set("src",d)};a.src=d}})}}}]);

//controllers.js
angular.module("jsGen.controllers",["ui.validate"]).controller("indexCtrl",["app","$scope","$routeParams","getList",function(a,b,c,f){var d="",h=a.restAPI.article,k=a.myConf,g=a.rootScope.global;g.title2=g.description;b.parent={getTpl:a.getFile.html("index-article.html"),viewPath:"latest",sumModel:k.sumModel(null,"index",!1)};b.other={};b.pagination={};b.setListModel=function(){var c=b.parent;c.sumModel=k.sumModel(!c.sumModel,"index");k.pageSize(c.sumModel?20:10,"index");a.location.search({})};(function(){var e=
a.location.path().slice(1).split("/");c.TAG||/^T[0-9A-Za-z]{3,}$/.test(e[0])?(h=a.restAPI.tag,b.other._id=e[0],b.other.title=c.TAG||e[0],b.parent.viewPath=""):(h=a.restAPI.article,b.parent.viewPath=e[0]||"latest");d=c.TAG||e[0]||"latest"})();(function(){var e={ID:d,p:c.p,s:c.s||k.pageSize(null,"index",20)};a.promiseGet(e,h,a.param(e),a.cache.list).then(function(c){var m=c.pagination||{};c.tag&&(b.other.title=c.tag.tag,b.other._id=c.tag._id);m.path=a.location.path();m.pageSize=k.pageSize(m.pageSize,
"index");b.pagination=m;b.articleList=c.data})})();f("comment").then(function(c){c=a.union(c.data);a.each(c,function(b,c){b.content=a.filter("cutText")(a.trim(b.content,!0),180)});b.hotComments=c.slice(0,6)})}]).controller("tagCtrl",["app","$scope","$routeParams","getList",function(a,b,c,f){var d=a.restAPI.tag,h=a.myConf;c={p:c.p,s:c.s||h.pageSize(null,"tag",50)};a.rootScope.global.title2=a.locale.TAG.title;b.parent={getTpl:a.getFile.html("index-tag.html")};b.pagination={};a.promiseGet(c,d,a.param(c),
a.cache.list).then(function(c){var g=c.pagination||{};g.path=a.location.path();g.pageSize=h.pageSize(g.pageSize,"tag");g.sizePerPage=[50,100,200];b.pagination=g;b.tagList=c.data});f("comment").then(function(c){c=a.union(c.data);a.each(c,function(b,c){b.content=a.filter("cutText")(a.trim(b.content,!0),180)});b.hotComments=c.slice(0,6)})}]).controller("userLoginCtrl",["app","$scope",function(a,b){a.clearUser();a.rootScope.global.title2=a.locale.USER.login;b.login={logauto:!0,logname:"",logpwd:""};b.reset=
{title:"",type:""};b.submit=function(){if(a.validate(b)){var c=a.union(b.login);c.logtime=Date.now()-a.timeOffset;c.logpwd=a.CryptoJS.SHA256(c.logpwd).toString();c.logpwd=a.CryptoJS.HmacSHA256(c.logpwd,c.logname+":"+c.logtime).toString();a.restAPI.user.save({ID:"login"},c,function(c){a.rootScope.global.user=c.data;a.checkUser();b.$destroy();a.location.path("/home")},function(c){b.reset.type=c.error.name;b.reset.title=a.locale.RESET[c.error.name]})}}}]).controller("userResetCtrl",["app","$scope","$routeParams",
function(a,b,c){function f(){b.timingModal.modal(!0);d=a.timing(function(a,c){b.parent.timing=c-a},1E3,b.parent.timing);d.then(function(){b.timingModal.modal(!1);a.location.search({}).path("/")})}var d,h=a.locale;a.rootScope.global.title2=h.USER.reset;b.reset={name:"",email:"",request:c.req};b.parent={title:h.RESET[c.req],timing:5};b.timingModal={confirmBtn:h.BTN_TEXT.goBack,confirmFn:function(){a.timing.cancel(d);a.timing(null,100,1).then(function(){a.location.search({}).path("/")});return!0},cancelBtn:h.BTN_TEXT.cancel,
cancelFn:function(){return a.timing.cancel(d)}};b.submit=function(){a.validate(b)&&a.restAPI.user.save({ID:"reset"},b.reset,function(b){a.toast.success(h.RESET.email,h.RESPONSE.success);f()})};0>["locked","passwd"].indexOf(c.req)&&a.restAPI.user.get({ID:"reset",OP:c.req},function(){a.toast.success(3+h.TIMING.goHome,h.RESPONSE.success);a.timing(null,1E3,3).then(function(){a.location.search({}).path("/home")})},f)}]).controller("userRegisterCtrl",["app","$scope",function(a,b){var c=a.filter,f=c("length"),
d=a.rootScope.global;a.clearUser();d.title2=a.locale.USER.register;b.user={name:"",email:"",passwd:"",passwd2:""};b.checkName=function(a,b){return c("checkName")(b.$value)};b.checkMin=function(a,b){return 5<=f(b.$value)};b.checkMax=function(a,b){return 15>=f(b.$value)};b.submit=function(){var c=b.user;if(a.validate(b)){var d={name:c.name,email:c.email};d.passwd=a.CryptoJS.SHA256(c.passwd).toString();a.restAPI.user.save({ID:"register"},d,function(c){a.rootScope.global.user=c.data;a.checkUser();b.$destroy();
a.location.path("/home")})}}}]).controller("homeCtrl",["app","$scope","$routeParams",function(a,b,c){var f=a.rootScope.global;if(!f.isLogin)return a.location.search({}).path("/");f.title2=a.locale.HOME.title;b.user=f.user;b.parent={getTpl:a.getFile.html(function(a){switch(a){case "follow":case "fans":return"user-list.html";case "detail":return"user-edit.html";case "article":case "comment":case "mark":return"user-article.html";default:return"user-article.html"}}(c.OP)),isMe:!0,viewPath:c.OP||"index"}}]).controller("userCtrl",
["app","$scope","$routeParams","getUser",function(a,b,c,f){a.rootScope.global.title2=a.locale.USER.title;b.parent={getTpl:a.getFile.html(function(){switch(c.OP){case "fans":return"user-list.html";case "article":return"user-article.html";default:return"user-article.html"}}()),isMe:!1,viewPath:c.OP||"index"};f("U"+c.ID).then(function(c){b.user=c.data;a.rootScope.global.title2=b.user.name+a.locale.USER.title})}]).controller("userListCtrl",["app","$scope","$routeParams",function(a,b,c){var f=a.restAPI.user,
d=a.myConf,h=a.locale,k={ID:c.ID&&"U"+c.ID||c.OP,OP:c.OP||"fans",p:c.p,s:c.s||d.pageSize(null,"user",20)};b.parent={title:""};a.promiseGet(k,f,a.param(k),a.cache.list).then(function(g){var e=g.pagination||{};e.path=a.location.path();e.pageSize=d.pageSize(e.pageSize,"user");b.pagination=e;a.each(g.data,function(b){a.checkFollow(b)});b.parent.title=c.ID?g.user.name+h.USER[k.OP]:h.HOME[k.OP];b.userList=g.data})}]).controller("userArticleCtrl",["app","$scope","$routeParams",function(a,b,c){var f=a.restAPI.user,
d=a.myConf,h=a.locale,k=a.rootScope.global;b.parent={sumModel:d.sumModel(null,"index",!1),title:""};b.pagination={};b.removeArticle=null;b.removeArticleModal={confirmBtn:h.BTN_TEXT.confirm,confirmFn:function(){var c=b.removeArticle;a.restAPI.article.remove({ID:c._id},function(){a.some(b.articleList,function(b,l,m){if(b._id===c._id)return m.splice(l,1),a.toast.success(h.ARTICLE.removed+c.title,h.RESPONSE.success),!0});b.removeArticle=null});return!0},cancelBtn:h.BTN_TEXT.cancel,cancelFn:function(){b.removeArticle=
null;return!0}};b.setListModel=function(){var c=b.parent;c.sumModel=d.sumModel(!c.sumModel,"home");d.pageSize(c.sumModel?20:10,"home");a.location.search({})};b.remove=function(a){if(a.isAuthor||k.isEditor)b.removeArticle=a,b.removeArticleModal.modal(!0)};(function(){var g={ID:c.ID&&"U"+c.ID||c.OP,OP:c.OP||(c.ID?"article":"index"),p:c.p,s:c.s||d.pageSize(null,"home",20)};a.promiseGet(g,f,a.param(g),a.cache.list).then(function(e){var l=0,m=e.pagination||{};m.path=a.location.path();m.pageSize=d.pageSize(m.pageSize,
"home");b.pagination=m;if(c.ID)b.parent.title=e.user.name+h.USER[g.OP];else{var f=k.user||{};a.each(e.data,function(a){0<e.readtimestamp&&(a.read=a.updateTime<e.readtimestamp,l+=!a.read);a.isAuthor=a.author._id===f._id});b.parent.title="index"!==g.OP?h.HOME[g.OP]:l+h.HOME.index+a.filter("date")(e.readtimestamp,"medium")}b.articleList=e.data})})()}]).controller("userEditCtrl",["app","$scope",function(a,b){function c(){f=a.union(k.user);a.each(f.tagsList,function(a,b,c){c[b]=a.tag});f=a.intersect(a.union(e),
f);b.user=a.union(f);a.checkDirty(e,f,b.user)}var f={},d=a.locale,h=a.filter,k=a.rootScope.global,g=h("length"),e={avatar:"",name:"",sex:"",email:"",desc:"",passwd:"",tagsList:[""]};b.sexArray=["male","female"];b.checkName=function(a,b){return h("checkName")(b.$value)};b.checkMin=function(a,b){return 5<=g(b.$value)};b.checkMax=function(a,b){return 15>=g(b.$value)};b.checkDesc=function(a,b){return g(b.$value)<=k.SummaryMaxLen};b.checkTag=function(a,b){var c=b.$value||"",c=angular.isString(c)?c.split(/[,\uff0c\u3001]/):
c;return c.length<=k.UserTagsMax};b.checkPwd=function(a,c){return(c.$value||"")===(b.user.passwd||"")};b.getTag=function(a){var c=b.user.tagsList;0>c.indexOf(a.tag)&&c.length<k.UserTagsMax&&(b.user.tagsList=c.concat(a.tag))};b.reset=function(){b.user=a.union(f)};b.verifyEmail=function(){a.restAPI.user.save({ID:"reset"},{request:"role"},function(){a.toast.success(d.RESET.email,d.RESPONSE.success)})};b.submit=function(){var l=a.union(b.user);a.validate(b)&&(l=a.checkDirty(e,f,l),a.isEmpty(l)?a.toast.info(d.USER.noUpdate):
(l.passwd&&(l.passwd=a.CryptoJS.SHA256(l.passwd).toString()),l.email&&(a.restAPI.user.save({ID:"reset"},{email:l.email,request:"email"},function(){a.toast.success(d.USER.email,d.RESPONSE.success)}),delete l.email),a.isEmpty(l)?c():a.restAPI.user.save({},l,function(b){a.union(k.user,b.data);c();a.toast.success(d.USER.updated,d.RESPONSE.success)})))};b.$watchCollection("user",function(b){a.checkDirty(e,f,b)});c()}]).controller("articleCtrl",["app","$scope","$routeParams","mdEditor","getList","getMarkdown",
function(a,b,c,f,d,h){function k(b){var c=q._id;angular.isObject(b)&&(b.isAuthor=c===b.author._id,b.isMark=a.some(b.markList,function(a){return a._id===c}),b.isFavor=a.some(b.favorsList,function(a){return a._id===c}),b.isOppose=a.some(b.opposesList,function(a){return a._id===c}),a.each(b.commentsList,function(a){k(a)}))}function g(){p.isLogin||a.toast.error(n.USER.noLogin);return p.isLogin}function e(){var a=b.comment,c=b.article;a.replyToComment="";a.title="\u8bc4\u8bba\uff1a"+u(c.title,p.TitleMaxLen-
9);a.content="";a.refer=c._id;b.replyMoving.prependTo("#comments")}var l="A"+c.ID,m=a.myConf,n=a.locale,p=a.rootScope.global;c=a.filter;var v=c("length"),u=c("cutText"),r=a.cache.comment,s=a.cache.list,t=a.restAPI.article,q=p.user||{},q={_id:q._id,name:q.name,avatar:q.avatar};b.parent={wmdPreview:!1,contentBytes:0,markdownHelp:""};b.comment={title:"",content:"",refer:"",replyToComment:""};b.replyMoving={};b.commentMoving={};b.markdownModal={title:n.ARTICLE.markdown,cancelBtn:n.BTN_TEXT.goBack};b.validateTooltip=
a.union(a.rootScope.validateTooltip);b.validateTooltip.placement="bottom";b.removeCommentModal={confirmBtn:n.BTN_TEXT.confirm,confirmFn:function(){var c=b.removeComment;a.restAPI.article.remove({ID:c._id},function(){a.some(b.article.commentsList,function(d,e,l){if(d._id===c._id)return l.splice(e,1),b.article.comments=l.length,a.toast.success(n.ARTICLE.removed+c.title,n.RESPONSE.success),!0});b.removeComment=null});return!0},cancelBtn:n.BTN_TEXT.cancel,cancelFn:function(){b.removeComment=null;return!0}};
b.remove=function(a){if(a.isAuthor||p.isEditor)b.removeComment=a,b.removeCommentModal.modal(!0)};b.wmdHelp=function(){h.success(function(a){b.parent.markdownHelp=a;b.markdownModal.modal(!0)})};b.wmdPreview=function(){b.parent.wmdPreview=!b.parent.wmdPreview;b.replyMoving.scrollIntoView(!0)};b.checkContentMin=function(a,c){var d=v(c.$value);b.parent.contentBytes=d;return d>=p.ContentMinLen};b.checkContentMax=function(a,b){return v(b.$value)<=p.ContentMaxLen};b.reply=function(c){var d=b.comment;d.refer=
c._id;b.parent.wmdPreview=!1;c._id===b.article._id?e():(d.replyToComment=c._id,d.title=n.ARTICLE.reply+u(a.sanitize(a.mdParse(c.content),0),p.TitleMaxLen-9),b.replyMoving.appendTo("#"+c._id));b.replyMoving.scrollIntoView()};b.getComments=function(c,d){function e(){var b=[];a.each(c,function(a){f[a]&&b.push(f[a])});return b}var l=[],f={};b.referComments=[];d&&(c&&0<c.length)&&(b.commentMoving.childrenOf("#"+d._id)?b.commentMoving.appendTo("#comments"):(b.commentMoving.appendTo("#"+d._id),a.each(c,
function(a){var b=r.get(a);b?f[a]=b:l.push(a)}),b.referComments=e(),0<l.length&&t.save({ID:"comment"},{data:l},function(c){a.each(c.data,function(a){k(a);r.put(a._id,a);f[a._id]=a});b.referComments=e()})))};b.highlight=function(a){a.status=2===a.status?1:2};b.setMark=function(b){g()&&t.save({ID:b._id,OP:"mark"},{mark:!b.isMark},function(){b.isMark=!b.isMark;b.isMark?b.markList.push(q):a.removeItem(q,"_id",b.markList);a.toast.success(n.ARTICLE[b.isMark?"marked":"unmarked"])})};b.setFavor=function(b){g()&&
t.save({ID:b._id,OP:"favor"},{favor:!b.isFavor},function(){b.isFavor=!b.isFavor;b.isFavor?(b.favorsList.push(q),a.removeItem(q,"_id",b.opposesList),b.isOppose=!1):a.removeItem(q,"_id",b.favorsList);a.toast.success(n.ARTICLE[b.isFavor?"favored":"unfavored"])})};b.setOppose=function(b){g()&&t.save({ID:b._id,OP:"oppose"},{oppose:!b.isOppose},function(){b.isOppose=!b.isOppose;b.isOppose?(b.opposesList.push(q),a.removeItem(q,"_id",b.favorsList),b.isFavor=!1):a.removeItem(q,"_id",b.opposesList);a.toast.success(n.ARTICLE[b.isOppose?
"opposed":"unopposed"])})};b.submit=function(){if(g()&&a.validate(b)){var c=a.union(b.comment),d=b.article;t.save({ID:d._id,OP:"comment"},c,function(c){var l=c.data,f=b.comment.replyToComment;d.commentsList.unshift(l);d.comments+=1;d.updateTime=Date.now();f&&a.some(d.commentsList,function(a,b,c){if(f===a._id)return a.commentsList.push(l._id),!0});r.put(l._id,l);e()})}};b.$on("genPagination",function(c,d,e){c.stopPropagation();c={ID:l,OP:"comment",p:d,s:m.pageSize(e,"comment",10)};a.promiseGet(c,t,
a.param(c),s).then(function(c){var d=c.pagination||{};c=c.data;d.pageSize=m.pageSize(d.pageSize,"comment");b.pagination=d;a.each(c,function(a){k(a);r.put(a._id,a)});b.article.commentsList=c;a.anchorScroll.toView("#comments",!0)})});f().run();a.promiseGet({ID:l},t,l,a.cache.article).then(function(c){var d=c.pagination||{};c=c.data;d.pageSize=m.pageSize(d.pageSize,"comments");k(c);a.each(c.commentsList,function(a){r.put(a._id,a)});p.title2=c.title;b.pagination=d;b.article=c;e();a.promiseGet({ID:c.author._id,
OP:"article"},a.restAPI.user,c.author._id,s).then(function(c){var d=c.user,e=b.article.author;a.checkFollow(d);a.union(e,d);e.articlesList=c.data})});d("hots").then(function(a){b.hotArticles=a.data.slice(0,10)})}]).controller("articleEditorCtrl",["app","$scope","$routeParams","mdEditor","getMarkdown",function(a,b,c,f,d){function h(c){s=a.union(r);c&&(c=a.union(c),a.each(c.tagsList,function(a,b,c){c[b]=a.tag}),c.refer=c.refer&&c.refer.url,a.intersect(s,c));b.article=a.union(s);a.checkDirty(r,s,b.article);
k(c)}function k(a){var c=b.parent,e=b.article;a?(c.title=m.ARTICLE.preview+l(e.title),c.content=e.content):d.success(function(a){c.title=m.ARTICLE.markdown;c.content=a})}var g,e=c.ID&&"A"+c.ID,l=a.toStr,m=a.locale,n=a.rootScope.global;c=a.filter;var p=c("length");c("cutText");var v=a.restAPI.article,u=a.cache.article,r={title:"",content:"",refer:"",tagsList:[]},s=a.union(r);n.isLogin||a.location.search({}).path("/");n.title2=a.locale.ARTICLE.title;b.parent={edit:!!e,wmdPreview:!0,contentBytes:0,titleBytes:0,
title:"",content:""};b.validateTooltip=a.union(a.rootScope.validateTooltip);b.validateTooltip.placement="bottom";b.checkTitleMin=function(c,d){var e=p(d.$value);b.parent.titleBytes=e;b.parent.wmdPreview&&(b.parent.title=m.ARTICLE.preview+a.sanitize(a.trim(d.$value),0));return e>=n.TitleMinLen};b.checkTitleMax=function(a,b){return p(b.$value)<=n.TitleMaxLen};b.checkContentMin=function(a,c){var d=p(c.$value);b.parent.contentBytes=d;b.parent.wmdPreview&&(b.parent.content=c.$value);return d>=n.ContentMinLen};
b.checkContentMax=function(a,b){return p(b.$value)<=n.ContentMaxLen};b.checkTag=function(a,b){var c=b.$value||"",c=angular.isString(c)?c.split(/[,\uff0c\u3001]/):c;return c.length<=n.ArticleTagsMax};b.getTag=function(a){var c=b.article.tagsList;0>c.indexOf(a.tag)&&c.length<n.ArticleTagsMax&&(b.article.tagsList=c.concat(a.tag))};b.wmdPreview=function(){var a=b.parent;a.wmdPreview=!a.wmdPreview;k(a.wmdPreview)};b.submit=function(){var c=a.union(b.article);a.validate(b)&&(a.checkDirty(r,s,c)?(c.title=
a.sanitize(a.trim(c.title),0),v.save({ID:e||"index",OP:e&&"edit"},c,function(b){var c=b.data;g&&(delete c.commentsList,c=b.data=a.union(g.data,c));u.put(c._id,b);h(c);a.toast.success(m.ARTICLE[e?"updated":"added"]+c.title);a.timing(null,1E3,2).then(function(){a.location.search({}).path("/"+c._id)})})):a.toast.info(m.ARTICLE.noUpdate))};b.$watchCollection("article",function(b){a.checkDirty(r,s,b)});f().run();e?(g=u.get(e),a.promiseGet({ID:e},v,e,u).then(function(a){h(a.data)})):h()}]).controller("adminCtrl",
["app","$scope","$routeParams",function(a,b,c){var f=a.rootScope.global;c=c.OP||"index";if(!f.isEditor)return a.location.search({}).path("/");b.parent={getTpl:a.getFile.html(function(a){return"admin-"+("comment"===a?"article":a)+".html"}(c)),viewPath:c};f.title2=a.locale.ADMIN[c]}]).controller("adminUserCtrl",["app","$scope","$routeParams",function(a,b,c){function f(c){d=a.intersect(a.union(e),c);b.userList=a.union(d);b.parent.editSave=!!a.checkDirty(e,d,b.userList)}var d={},h=a.restAPI.user,k=a.myConf,
g=a.locale;c={ID:"admin",p:c.p,s:c.s||k.pageSize(null,"userAdmin",20)};var e=[{_id:"",name:"",locked:!1,email:"",role:0,score:0,date:0,lastLoginDate:0}];b.parent={editSave:!1,isSelectAll:!1};b.pagination={};b.roleArray=[0,1,2,3,4,5];b.selectAll=function(){a.each(b.userList,function(a){a.isSelect=b.parent.isSelectAll})};b.reset=function(){b.userList=a.union(d)};b.submit=function(){var c=[{_id:"",locked:!1,role:0}];if(a.validate(b)){var m=a.checkDirty(e,d,b.userList);a.isEmpty(m)?a.toast.info(g.USER.noUpdate):
(m=a.intersect(c,m),h.save({ID:"admin"},{data:m},function(c){var d=[];a.each(c.data,function(c){a.some(b.userList,function(b){if(c._id===b._id)return a.union(b,c),d.push(c.name),!0})});f(b.userList);a.toast.success(g.USER.updated+d.join(", "),g.RESPONSE.success)}))}};b.$watch("userList",function(c){b.parent.editSave=!!a.checkDirty(e,d,c)},!0);a.promiseGet(c,h).then(function(c){var d=c.pagination||{};d.path=a.location.path();d.pageSize=k.pageSize(d.pageSize,"userAdmin");d.sizePerPage=[20,100,200];
b.pagination=d;f(c.data)})}]).controller("adminTagCtrl",["app","$scope","$routeParams",function(a,b,c){function f(c){d=a.union(a.union(e),c);b.tagList=a.union(d);b.parent.editSave=!!a.checkDirty(e,d,b.tagList)}var d={},h=a.restAPI.tag,k=a.myConf,g=a.locale;c={ID:"index",p:c.p,s:c.s||k.pageSize(null,"tagAdmin",20)};var e=[{_id:"",articles:0,tag:"",users:0}];b.parent={editSave:!1};b.pagination={};b.removeTag=null;b.removeTagModal={confirmBtn:g.BTN_TEXT.confirm,confirmFn:function(){var c=b.removeTag;
h.remove({ID:c._id},function(){a.some(b.tagList,function(b,d,e){if(b._id===c._id)return e.splice(d,1),a.toast.success(g.TAG.removed+c.tag,g.RESPONSE.success),!0});f(b.tagList);b.removeTag=null});return!0},cancelBtn:g.BTN_TEXT.cancel,cancelFn:function(){b.removeTag=null;return!0}};b.checkTag=function(b,c){var d=a.toStr(c.$value);return!/[,\uff0c\u3001]/.test(d)};b.checkTagMin=function(b,c){return 3<=a.filter("length")(c.$value)};b.reset=function(){b.tagList=a.union(d)};b.remove=function(a){b.removeTag=
a;b.removeTagModal.modal(!0)};b.submit=function(){var c=[{_id:"",tag:""}];if(a.validate(b)){var m=a.checkDirty(e,d,b.tagList);a.isEmpty(m)?a.toast.info(g.TAG.noUpdate):(m=a.intersect(c,m),h.save({ID:"admin"},{data:m},function(c){var d=[];a.each(m,function(d){c.data[d._id]||a.some(b.tagList,function(a,b,c){if(d._id===a._id)return c.splice(b,1),!0})});a.each(c.data,function(c){a.some(b.tagList,function(b,e,f){if(c._id===b._id)return a.union(b,c),d.push(c.tag),!0})});f(b.tagList);a.toast.success(g.TAG.updated+
d.join(", "),g.RESPONSE.success)}))}};b.$watch("tagList",function(c){b.parent.editSave=!!a.checkDirty(e,d,c)},!0);a.promiseGet(c,h).then(function(c){var d=c.pagination||{};d.path=a.location.path();d.pageSize=k.pageSize(d.pageSize,"tagAdmin");d.sizePerPage=[20,50,100];b.pagination=d;f(c.data)})}]).controller("adminArticleCtrl",["app","$scope",function(a,b){}]).controller("adminGlobalCtrl",["app","$scope",function(a,b){function c(c){b.global=a.union(c);d=a.union(c);d=a.intersect(a.union(f),d);b.editGlobal=
a.union(d);a.checkDirty(f,d,b.editGlobal)}var f,d={},h=a.locale,k=a.filter,g=a.restAPI.index;k("length");b.parent={switchTab:"tab1"};b.reset=function(){b.editGlobal=a.union(d)};b.submit=function(){var e=a.union(b.editGlobal);a.validate(b)&&(e=a.checkDirty(f,d,e),a.isEmpty(e)?a.toast.info(h.ADMIN.noUpdate):g.save({OP:"admin"},e,function(b){c(b.data);b=a.union(d);delete b.smtp;delete b.email;a.union(a.rootScope.global,b);a.toast.success(h.ADMIN.updated,h.RESPONSE.success)}))};b.$watchCollection("editGlobal",
function(b){a.checkDirty(f,d,b)});a.promiseGet({OP:"admin"},g).then(function(a){f=a.configTpl;c(a.data)})}]);

//app.js
angular.module("jsGen","ngAnimate jsGen.tools jsGen.router jsGen.filters jsGen.services jsGen.locale jsGen.directives jsGen.controllers".split(" ")).config(["$httpProvider","app",function(a,f){var b=0,g=!1,e={count:0,total:0,cancel:function(){b=0;g=!1;this.total=this.count=0;f.loading(!1,this)}};a.defaults.transformRequest.push(function(a){b+=1;e.count=b;e.total+=1;g||window.setTimeout(function(){!g&&0<b&&(g=!0,f.loading(!0,e))},1E3);return a});a.defaults.transformResponse.push(function(a){b-=1;e.count=
b;g&&0===b&&e.cancel();return a});a.interceptors.push(function(){return{response:function(a){var b,e=a.data;angular.isObject(e)&&(f.timestamp=e.timestamp,b=!e.ack&&e.error);return b?(f.toast.error(b.message,b.name),f.q.reject(e)):a},responseError:function(a){var b=a.data||a;a=a.status||"";var e=b.message||(angular.isObject(b)?"Error!":b);f.toast.error(e,a);return f.q.reject(b)}}})}]).run(["app","$q","$rootScope","$location","$timeout","$filter","$locale","getFile","tools","toast","timing","cache",
"restAPI","sanitize","mdParse","mdEditor","CryptoJS","promiseGet","myConf","anchorScroll","isVisible","applyFn","param",function(a,f,b,g,e,t,h,u,v,w,p,x,l,y,z,A,B,C,D,E,F,q,G){function r(){var a=c.viewWidth=n.width();c.viewHeight=n.height();c.isPocket=480>a;c.isPhone=768>a;c.isTablet=!c.isPhone&&980>a;c.isDesktop=980<=a}function s(){l.index.get({},function(d){a.timeOffset=Date.now()-d.timestamp;d=d.data;d.title2=d.description;d.info.angularjs=angular.version.full;a.union(c,d);a.checkUser()})}var k=
!1,m="",c=b.global={isAdmin:!1,isEditor:!1,isLogin:!1},n=$(window);window.app=a;a.q=f;a.toast=w;a.param=G;a.timing=p;a.location=g;a.timeout=e;a.timeOffset=0;a.timestamp=Date.now()+0;a.filter=t;a.locale=h;a.anchorScroll=E;a.isVisible=F;a.getFile=u;a.cache=x;a.restAPI=l;a.sanitize=y;a.mdParse=z;a.mdEditor=A;a.CryptoJS=B;a.promiseGet=C;a.myConf=D;a.rootScope=b;angular.extend(a,v);a.loading=function(a,c){b.loading.show=a;q()};a.validate=function(d,b){var c=[],e=[];d.$broadcast("genTooltipValidate",c,
b);a.each(c,function(a){a.validate&&a.$invalid&&e.push(a)});0===e.length?(a.validate.errorList=null,d.$broadcast("genTooltipValidate",c,!0)):a.validate.errorList=e;return!a.validate.errorList};a.checkDirty=function(d,b,c){(d=a.union(d))&&b&&c?(a.intersect(d,c),a.each(d,function(a,d,c){angular.equals(a,b[d])&&delete c[d]}),a.remove(d,void 0),k=!a.isEmpty(d)):k=!1;return k?d:null};a.removeItem=function(d,b,c){return a.some(c,function(a,e){if(a[b]===d[b])return c.splice(e,1),!0})};a.checkUser=function(){c.isLogin=
!!c.user;c.isAdmin=c.user&&5===c.user.role;c.isEditor=c.user&&4<=c.user.role};a.clearUser=function(){c.user=null;a.checkUser()};a.checkFollow=function(d){var b=c.user||{};d.isMe=d._id===b._id;d.isFollow=!d.isMe&&a.some(b.followList,function(a){return a===d._id})};b.loading={show:!1};b.validateTooltip={validate:!0,validateMsg:h.VALIDATE};b.unSaveModal={confirmBtn:h.BTN_TEXT.confirm,confirmFn:function(){k&&m&&(k=!1,e(function(){window.location.href=m},100));return!0},cancelBtn:h.BTN_TEXT.cancel,cancelFn:!0};
b.$on("$locationChangeStart",function(a,c,e){k?(a.preventDefault(),m=c,b.unSaveModal.modal(!0)):m=""});b.goBack=function(){window.history.go(-1)};b.logout=function(){l.user.get({ID:"logout"},function(){c.user=null;a.checkUser();g.path("/")})};b.followMe=function(b){l.user.save({ID:b._id},{follow:!b.isFollow},function(e){e.follow?(c.user.followList.push(b._id),a.toast.success(h.USER.followed+b.name,h.RESPONSE.success)):a.some(c.user.followList,function(c,e,f){if(c===b._id)return f.splice(e,1),a.toast.success(h.USER.unfollowed+
b.name,h.RESPONSE.success),!0});b.fans+=b.isFollow?-1:1;b.isFollow=!b.isFollow})};n.resize(q.bind(null,r));p(function(){24E4<=Date.now()-a.timestamp-a.timeOffset&&s()},12E4);r();s()}]);
